<div class="home-by-role min-h-screen bg-orange-50 pb-24 font-outfit">
  @if (isLoading()) {
  <div class="p-5 space-y-3">
    <app-skeleton-card [count]="3"></app-skeleton-card>
  </div>
  } @else {
  <!-- CLIENT: Dashboard (estilos Figma; header y bottom nav vienen del main-layout) -->
  @if (userRole() !== 'ENGINEER' && userRole() !== 'SUPERVISOR' && userRole() !== 'PARTNER') {
  <div class="min-h-full">
    <div class="p-4 space-y-6">
      <!-- Opciones de Financiamiento (primero) -->
      <div class="dashboard-section">
        <div class="rounded-xl border border-orange-200 bg-orange-100 overflow-hidden">
          <div class="p-4 border-b border-orange-200/50">
            <h3 class="font-bold text-orange-800">Opciones de Financiamiento</h3>
          </div>
          <div class="p-4">
            @if (hasFinancingRequestInProgress() && inProgressFinancingRequest(); as req) {
              <p class="text-sm text-orange-900/90 mb-3">Tienes una solicitud de financiamiento en curso.</p>
              <a [routerLink]="['/financing-tracking']"
                class="block rounded-xl border border-orange-200 bg-white p-4 mb-3 cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98] no-underline text-inherit">
                <div class="flex justify-between items-center">
                  <div>
                    <h4 class="font-medium text-foreground">Solicitud de Financiamiento</h4>
                    <p class="text-sm text-gray-500">{{ req.requestCode }}</p>
                  </div>
                  <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-amber-100 text-amber-800">
                    Pendiente de aprobación
                  </span>
                </div>
                <p class="text-xs text-orange-700 mt-2">Toca para ver seguimiento</p>
              </a>
              <button type="button" disabled
                class="w-full flex items-center justify-center gap-2 py-2.5 px-4 border border-orange-300 text-orange-400 font-medium rounded-lg bg-orange-50/50 cursor-not-allowed">
                <lucide-icon [name]="icons.CreditCard" class="w-[18px] h-[18px]"></lucide-icon>
                Ver Planes
              </button>
            } @else {
              <p class="text-sm text-orange-900/90 mb-3">Financia tus proyectos desde $200 hasta $1,500</p>
              <button type="button" (click)="navigateTo('/financing')"
                class="w-full flex items-center justify-center gap-2 py-2.5 px-4 border border-[#FF5500] text-[#FF5500] font-medium rounded-lg bg-transparent hover:bg-orange-50 transition-colors">
                <lucide-icon [name]="icons.CreditCard" class="w-[18px] h-[18px]"></lucide-icon>
                Ver Planes
              </button>
            }
          </div>
        </div>
      </div>

      <!-- Quick action: Solicitar Servicio -->
      <div class="dashboard-section">
        <button type="button" (click)="navigateTo('/service-request')"
          class="w-full h-16 bg-[#FF5500] hover:bg-[#FF6600] text-white text-lg font-medium shadow-lg rounded-xl flex items-center justify-center gap-2 transition-all active:scale-[0.98]">
          <lucide-icon [name]="icons.Wrench" class="w-6 h-6"></lucide-icon>
          Solicitar Servicio
        </button>
      </div>

      <!-- Servicios Recientes -->
      <div class="dashboard-section">
        <h3 class="font-bold text-lg mb-3">Servicios Recientes</h3>
        <div class="space-y-2">
          @for (service of recentServices(); track service.id) {
          <div (click)="navigateToTracking(service)"
            class="recent-service-item rounded-xl border border-slate-200 bg-white p-4 cursor-pointer hover:shadow-md transition-shadow active:scale-[0.98]"
            [style.--index]="$index"
            animate.enter="recent-service-enter">
            <div class="flex justify-between items-center">
              <div>
                <h4 class="font-medium text-foreground">{{ service.title }}</h4>
                <p class="text-sm text-gray-500">{{ service.date }}</p>
                @if (service.visitDate) {
                  <p class="text-xs text-slate-600 mt-0.5">Visita: {{ service.visitDate }}</p>
                }
              </div>
              <span [class]="service.status === 'Finalizado' ? 'bg-green-500 text-white' : 'bg-[#FF5500] text-white'"
                class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-white">
                {{ service.status }}
              </span>
            </div>
          </div>
          } @empty {
          <div class="p-8 text-center border-2 border-dashed border-slate-200 rounded-xl">
            <p class="text-sm text-gray-500">No tienes servicios recientes.</p>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
  }

<!-- ENGINEER: Visitas Técnicas de Hoy + Mis Asignaciones -->
@if (userRole() === 'ENGINEER') {
<div class="p-5 max-w-lg mx-auto">
  <header class="mb-6">
    <h1 class="text-xl font-black text-slate-900 tracking-tight">Visitas Técnicas de Hoy</h1>
    <p class="text-slate-500 text-sm mt-0.5">Resumen de tus asignaciones</p>
  </header>
  <div class="rounded-2xl bg-card border border-border/50 shadow-sm p-6 mb-6">
    <p class="text-4xl font-black text-[#FF5500] tabular-nums">{{ todayVisitsCount() }}</p>
    <p class="text-sm font-medium text-muted-foreground mt-1">visitas programadas</p>
  </div>
  <a routerLink="/engineer"
    class="flex items-center justify-center gap-3 w-full py-4 px-6 bg-[#FF5500] text-white font-bold rounded-[2.5rem] shadow-orange-200 hover:shadow-[0_6px_20px_0_rgba(255,85,0,0.3)] transition-shadow no-underline">
    <lucide-icon [name]="icons.ClipboardList" class="w-6 h-6"></lucide-icon>
    <span>Mis Asignaciones</span>
  </a>
</div>
}

<!-- PARTNER: Panel de proveedor -->
@if (userRole() === 'PARTNER') {
<div class="p-5 max-w-lg mx-auto">
  <header class="mb-6">
    <h1 class="text-xl font-black text-slate-900 tracking-tight">Panel Partner</h1>
    <p class="text-slate-500 text-sm mt-0.5">Gestión de pedidos y materiales</p>
  </header>
  <a routerLink="/partner"
    class="flex items-center justify-center gap-3 w-full py-4 px-6 bg-[#FF5500] text-white font-bold rounded-[2.5rem] shadow-orange-200 hover:shadow-[0_6px_20px_0_rgba(255,85,0,0.3)] transition-shadow no-underline">
    <lucide-icon [name]="icons.ClipboardList" class="w-6 h-6"></lucide-icon>
    <span>Ir al Panel</span>
  </a>
</div>
}

<!-- SUPERVISOR: KPIs + Gestión -->
@if (userRole() === 'SUPERVISOR') {
<div class="p-5 max-w-lg mx-auto">
  <header class="mb-6">
    <h1 class="text-xl font-black text-slate-900 tracking-tight">Panel de Supervisión</h1>
    <p class="text-slate-500 text-sm mt-0.5">Indicadores clave</p>
  </header>
  <div class="grid grid-cols-2 gap-4 mb-6">
    <div class="rounded-2xl bg-card border border-border/50 shadow-sm p-5">
      <p class="text-3xl font-black text-foreground tabular-nums">{{ creditsPendingCount() }}</p>
      <p class="text-xs font-bold text-muted-foreground uppercase tracking-wider mt-1">Créditos por Aprobar</p>
    </div>
    <div class="rounded-2xl bg-card border border-rose-100/50 shadow-sm p-5">
      <p class="text-3xl font-black text-rose-600 tabular-nums">{{ worksUnassignedCount() }}</p>
      <p class="text-xs font-bold text-muted-foreground uppercase tracking-wider mt-1">Obras sin Ingeniero</p>
    </div>
  </div>
  <a routerLink="/supervisor"
    class="flex items-center justify-center gap-3 w-full py-4 px-6 bg-[#FF5500] text-white font-bold rounded-[2.5rem] shadow-orange-200 hover:shadow-[0_6px_20px_0_rgba(255,85,0,0.3)] transition-shadow no-underline">
    <lucide-icon [name]="icons.Wrench" class="w-6 h-6"></lucide-icon>
    <span>Gestión de Créditos y Asignación</span>
  </a>
</div>
}
}
</div>
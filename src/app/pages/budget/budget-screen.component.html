<div class="budget-screen min-h-screen bg-gradient-to-b from-orange-50 to-white pb-20">
  <header class="bg-gradient-to-r from-[#FF5500] to-[#FF6600] text-white p-4 shadow-lg sticky top-0 z-10">
    <div class="flex items-center gap-3">
      <button type="button" (click)="goBack()" class="p-2 -m-2 text-white hover:bg-white/20 rounded-lg transition-colors" aria-label="Volver">
        <lucide-icon [name]="icons.ArrowLeft" class="w-6 h-6"></lucide-icon>
      </button>
      <h1 class="text-xl font-bold">Presupuestos Recibidos</h1>
    </div>
  </header>

  <div class="p-4 space-y-4">
    @for (budget of budgets; track budget.id) {
      <section
        (click)="selectBudget(budget.id)"
        [class]="selectedBudgetId() === budget.id ? 'border-2 border-[#FF5500] shadow-lg' : 'border border-slate-200 hover:shadow-md'"
        class="rounded-xl bg-white p-4 cursor-pointer transition-all active:scale-[0.99]"
      >
        <div class="flex items-start justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-orange-200 text-orange-700 flex items-center justify-center font-bold text-sm">
              {{ initials(budget.technicianName) }}
            </div>
            <div>
              <h3 class="font-bold text-slate-900">{{ budget.technicianName }}</h3>
              <div class="flex items-center gap-2 text-sm text-gray-600">
                <span>⭐ {{ budget.rating }}</span>
                <span>•</span>
                <span>{{ budget.completedJobs }} trabajos</span>
              </div>
            </div>
          </div>
          @if (selectedBudgetId() === budget.id) {
            <div class="bg-[#FF5500] text-white rounded-full p-1">
              <lucide-icon [name]="icons.Check" class="w-5 h-5"></lucide-icon>
            </div>
          }
        </div>

        <p class="text-sm text-gray-600 mb-3">{{ budget.description }}</p>

        <div class="grid grid-cols-2 gap-3 mb-3">
          <div class="flex items-center gap-2">
            <lucide-icon [name]="icons.DollarSign" class="w-[18px] h-[18px] text-green-600"></lucide-icon>
            <div>
              <p class="text-xs text-gray-500">Precio</p>
              <p class="font-bold text-slate-900">${{ budget.price }}</p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <lucide-icon [name]="icons.Clock" class="w-[18px] h-[18px] text-blue-600"></lucide-icon>
            <div>
              <p class="text-xs text-gray-500">Tiempo estimado</p>
              <p class="font-medium text-sm text-slate-800">{{ budget.estimatedTime }}</p>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-2 bg-green-50 p-2 rounded-lg">
          <lucide-icon [name]="icons.Calendar" class="w-[18px] h-[18px] text-green-600 shrink-0"></lucide-icon>
          <span class="text-sm font-medium text-slate-800">Disponible: {{ budget.availability }}</span>
        </div>
      </section>
    }

    @if (selectedBudgetId() !== null) {
      <section class="rounded-xl border border-orange-200 bg-orange-50 p-4 space-y-3">
        <h2 class="font-bold text-lg text-slate-900">Agendar Visita</h2>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-2 block">Fecha preferida</label>
          <input
            type="date"
            [ngModel]="selectedDate()"
            (ngModelChange)="selectedDate.set($event)"
            [min]="today"
            class="w-full p-2 border border-slate-200 rounded-lg bg-white"
          />
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-2 block">Hora preferida</label>
          <input
            type="time"
            [ngModel]="selectedTime()"
            (ngModelChange)="selectedTime.set($event)"
            class="w-full p-2 border border-slate-200 rounded-lg bg-white"
          />
        </div>
        <button
          type="button"
          (click)="acceptAndSchedule()"
          [disabled]="!selectedDate() || !selectedTime()"
          class="w-full py-3 rounded-xl bg-gradient-to-r from-[#FF5500] to-[#FF6600] hover:from-[#FF6600] hover:to-[#FF7700] text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-opacity"
        >
          Aceptar y Agendar
        </button>
      </section>
    }
  </div>
</div>
